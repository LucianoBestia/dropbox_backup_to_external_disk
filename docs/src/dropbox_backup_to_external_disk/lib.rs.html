<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Source of the Rust file `src/lib.rs`."><meta name="keywords" content="rust, rustlang, rust-lang"><title>lib.rs - source</title><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled ><script id="default-settings"></script><script src="../../storage.js"></script><script src="../../crates.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../../favicon.svg">
<link rel="alternate icon" type="image/png" href="../../favicon-16x16.png">
<link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../../down-arrow.svg");}</style></head><body class="rustdoc source"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../../dropbox_backup_to_external_disk/index.html'><div class='logo-container rust-logo'><img src='../../rust-logo.png' alt='logo'></div></a></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img src="../../brush.svg" width="18" height="18" alt="Pick another theme!"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../settings.html" title="settings"><img src="../../wheel.svg" width="18" height="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><div class="example-wrap"><pre class="line-numbers"><span id="1">  1</span>
<span id="2">  2</span>
<span id="3">  3</span>
<span id="4">  4</span>
<span id="5">  5</span>
<span id="6">  6</span>
<span id="7">  7</span>
<span id="8">  8</span>
<span id="9">  9</span>
<span id="10"> 10</span>
<span id="11"> 11</span>
<span id="12"> 12</span>
<span id="13"> 13</span>
<span id="14"> 14</span>
<span id="15"> 15</span>
<span id="16"> 16</span>
<span id="17"> 17</span>
<span id="18"> 18</span>
<span id="19"> 19</span>
<span id="20"> 20</span>
<span id="21"> 21</span>
<span id="22"> 22</span>
<span id="23"> 23</span>
<span id="24"> 24</span>
<span id="25"> 25</span>
<span id="26"> 26</span>
<span id="27"> 27</span>
<span id="28"> 28</span>
<span id="29"> 29</span>
<span id="30"> 30</span>
<span id="31"> 31</span>
<span id="32"> 32</span>
<span id="33"> 33</span>
<span id="34"> 34</span>
<span id="35"> 35</span>
<span id="36"> 36</span>
<span id="37"> 37</span>
<span id="38"> 38</span>
<span id="39"> 39</span>
<span id="40"> 40</span>
<span id="41"> 41</span>
<span id="42"> 42</span>
<span id="43"> 43</span>
<span id="44"> 44</span>
<span id="45"> 45</span>
<span id="46"> 46</span>
<span id="47"> 47</span>
<span id="48"> 48</span>
<span id="49"> 49</span>
<span id="50"> 50</span>
<span id="51"> 51</span>
<span id="52"> 52</span>
<span id="53"> 53</span>
<span id="54"> 54</span>
<span id="55"> 55</span>
<span id="56"> 56</span>
<span id="57"> 57</span>
<span id="58"> 58</span>
<span id="59"> 59</span>
<span id="60"> 60</span>
<span id="61"> 61</span>
<span id="62"> 62</span>
<span id="63"> 63</span>
<span id="64"> 64</span>
<span id="65"> 65</span>
<span id="66"> 66</span>
<span id="67"> 67</span>
<span id="68"> 68</span>
<span id="69"> 69</span>
<span id="70"> 70</span>
<span id="71"> 71</span>
<span id="72"> 72</span>
<span id="73"> 73</span>
<span id="74"> 74</span>
<span id="75"> 75</span>
<span id="76"> 76</span>
<span id="77"> 77</span>
<span id="78"> 78</span>
<span id="79"> 79</span>
<span id="80"> 80</span>
<span id="81"> 81</span>
<span id="82"> 82</span>
<span id="83"> 83</span>
<span id="84"> 84</span>
<span id="85"> 85</span>
<span id="86"> 86</span>
<span id="87"> 87</span>
<span id="88"> 88</span>
<span id="89"> 89</span>
<span id="90"> 90</span>
<span id="91"> 91</span>
<span id="92"> 92</span>
<span id="93"> 93</span>
<span id="94"> 94</span>
<span id="95"> 95</span>
<span id="96"> 96</span>
<span id="97"> 97</span>
<span id="98"> 98</span>
<span id="99"> 99</span>
<span id="100">100</span>
<span id="101">101</span>
<span id="102">102</span>
<span id="103">103</span>
<span id="104">104</span>
<span id="105">105</span>
<span id="106">106</span>
<span id="107">107</span>
<span id="108">108</span>
<span id="109">109</span>
<span id="110">110</span>
<span id="111">111</span>
<span id="112">112</span>
<span id="113">113</span>
<span id="114">114</span>
<span id="115">115</span>
<span id="116">116</span>
<span id="117">117</span>
<span id="118">118</span>
<span id="119">119</span>
<span id="120">120</span>
<span id="121">121</span>
<span id="122">122</span>
<span id="123">123</span>
<span id="124">124</span>
<span id="125">125</span>
<span id="126">126</span>
<span id="127">127</span>
<span id="128">128</span>
<span id="129">129</span>
<span id="130">130</span>
<span id="131">131</span>
<span id="132">132</span>
<span id="133">133</span>
<span id="134">134</span>
<span id="135">135</span>
<span id="136">136</span>
<span id="137">137</span>
<span id="138">138</span>
<span id="139">139</span>
<span id="140">140</span>
<span id="141">141</span>
<span id="142">142</span>
<span id="143">143</span>
<span id="144">144</span>
<span id="145">145</span>
<span id="146">146</span>
<span id="147">147</span>
<span id="148">148</span>
<span id="149">149</span>
<span id="150">150</span>
<span id="151">151</span>
<span id="152">152</span>
<span id="153">153</span>
<span id="154">154</span>
<span id="155">155</span>
<span id="156">156</span>
<span id="157">157</span>
<span id="158">158</span>
<span id="159">159</span>
<span id="160">160</span>
<span id="161">161</span>
<span id="162">162</span>
<span id="163">163</span>
<span id="164">164</span>
<span id="165">165</span>
<span id="166">166</span>
<span id="167">167</span>
<span id="168">168</span>
<span id="169">169</span>
<span id="170">170</span>
<span id="171">171</span>
<span id="172">172</span>
<span id="173">173</span>
<span id="174">174</span>
<span id="175">175</span>
<span id="176">176</span>
<span id="177">177</span>
<span id="178">178</span>
<span id="179">179</span>
<span id="180">180</span>
<span id="181">181</span>
<span id="182">182</span>
<span id="183">183</span>
<span id="184">184</span>
<span id="185">185</span>
<span id="186">186</span>
<span id="187">187</span>
<span id="188">188</span>
<span id="189">189</span>
<span id="190">190</span>
<span id="191">191</span>
<span id="192">192</span>
<span id="193">193</span>
<span id="194">194</span>
<span id="195">195</span>
<span id="196">196</span>
<span id="197">197</span>
<span id="198">198</span>
<span id="199">199</span>
<span id="200">200</span>
<span id="201">201</span>
<span id="202">202</span>
<span id="203">203</span>
<span id="204">204</span>
<span id="205">205</span>
<span id="206">206</span>
<span id="207">207</span>
<span id="208">208</span>
<span id="209">209</span>
<span id="210">210</span>
<span id="211">211</span>
<span id="212">212</span>
<span id="213">213</span>
<span id="214">214</span>
<span id="215">215</span>
<span id="216">216</span>
<span id="217">217</span>
<span id="218">218</span>
<span id="219">219</span>
<span id="220">220</span>
<span id="221">221</span>
<span id="222">222</span>
<span id="223">223</span>
<span id="224">224</span>
<span id="225">225</span>
<span id="226">226</span>
<span id="227">227</span>
<span id="228">228</span>
<span id="229">229</span>
<span id="230">230</span>
<span id="231">231</span>
<span id="232">232</span>
<span id="233">233</span>
<span id="234">234</span>
<span id="235">235</span>
<span id="236">236</span>
<span id="237">237</span>
<span id="238">238</span>
<span id="239">239</span>
<span id="240">240</span>
<span id="241">241</span>
<span id="242">242</span>
<span id="243">243</span>
<span id="244">244</span>
<span id="245">245</span>
<span id="246">246</span>
<span id="247">247</span>
<span id="248">248</span>
<span id="249">249</span>
<span id="250">250</span>
<span id="251">251</span>
<span id="252">252</span>
<span id="253">253</span>
<span id="254">254</span>
<span id="255">255</span>
<span id="256">256</span>
<span id="257">257</span>
<span id="258">258</span>
<span id="259">259</span>
<span id="260">260</span>
<span id="261">261</span>
<span id="262">262</span>
<span id="263">263</span>
<span id="264">264</span>
<span id="265">265</span>
<span id="266">266</span>
<span id="267">267</span>
<span id="268">268</span>
<span id="269">269</span>
<span id="270">270</span>
<span id="271">271</span>
<span id="272">272</span>
<span id="273">273</span>
<span id="274">274</span>
<span id="275">275</span>
<span id="276">276</span>
<span id="277">277</span>
<span id="278">278</span>
<span id="279">279</span>
<span id="280">280</span>
<span id="281">281</span>
<span id="282">282</span>
<span id="283">283</span>
<span id="284">284</span>
<span id="285">285</span>
<span id="286">286</span>
<span id="287">287</span>
<span id="288">288</span>
<span id="289">289</span>
<span id="290">290</span>
<span id="291">291</span>
<span id="292">292</span>
<span id="293">293</span>
<span id="294">294</span>
<span id="295">295</span>
<span id="296">296</span>
<span id="297">297</span>
<span id="298">298</span>
<span id="299">299</span>
<span id="300">300</span>
<span id="301">301</span>
<span id="302">302</span>
<span id="303">303</span>
<span id="304">304</span>
<span id="305">305</span>
<span id="306">306</span>
<span id="307">307</span>
<span id="308">308</span>
<span id="309">309</span>
<span id="310">310</span>
<span id="311">311</span>
<span id="312">312</span>
<span id="313">313</span>
<span id="314">314</span>
<span id="315">315</span>
<span id="316">316</span>
<span id="317">317</span>
<span id="318">318</span>
<span id="319">319</span>
<span id="320">320</span>
<span id="321">321</span>
<span id="322">322</span>
<span id="323">323</span>
<span id="324">324</span>
<span id="325">325</span>
<span id="326">326</span>
<span id="327">327</span>
<span id="328">328</span>
<span id="329">329</span>
<span id="330">330</span>
<span id="331">331</span>
<span id="332">332</span>
<span id="333">333</span>
<span id="334">334</span>
<span id="335">335</span>
<span id="336">336</span>
<span id="337">337</span>
<span id="338">338</span>
<span id="339">339</span>
<span id="340">340</span>
<span id="341">341</span>
<span id="342">342</span>
<span id="343">343</span>
<span id="344">344</span>
<span id="345">345</span>
<span id="346">346</span>
<span id="347">347</span>
<span id="348">348</span>
<span id="349">349</span>
<span id="350">350</span>
<span id="351">351</span>
<span id="352">352</span>
<span id="353">353</span>
<span id="354">354</span>
<span id="355">355</span>
<span id="356">356</span>
<span id="357">357</span>
<span id="358">358</span>
<span id="359">359</span>
<span id="360">360</span>
<span id="361">361</span>
<span id="362">362</span>
<span id="363">363</span>
<span id="364">364</span>
<span id="365">365</span>
<span id="366">366</span>
<span id="367">367</span>
<span id="368">368</span>
<span id="369">369</span>
<span id="370">370</span>
<span id="371">371</span>
<span id="372">372</span>
<span id="373">373</span>
<span id="374">374</span>
<span id="375">375</span>
<span id="376">376</span>
<span id="377">377</span>
<span id="378">378</span>
<span id="379">379</span>
<span id="380">380</span>
<span id="381">381</span>
<span id="382">382</span>
<span id="383">383</span>
<span id="384">384</span>
<span id="385">385</span>
<span id="386">386</span>
<span id="387">387</span>
<span id="388">388</span>
<span id="389">389</span>
<span id="390">390</span>
<span id="391">391</span>
<span id="392">392</span>
<span id="393">393</span>
<span id="394">394</span>
<span id="395">395</span>
<span id="396">396</span>
<span id="397">397</span>
<span id="398">398</span>
<span id="399">399</span>
<span id="400">400</span>
<span id="401">401</span>
<span id="402">402</span>
<span id="403">403</span>
<span id="404">404</span>
<span id="405">405</span>
<span id="406">406</span>
<span id="407">407</span>
<span id="408">408</span>
<span id="409">409</span>
<span id="410">410</span>
<span id="411">411</span>
<span id="412">412</span>
<span id="413">413</span>
<span id="414">414</span>
<span id="415">415</span>
<span id="416">416</span>
<span id="417">417</span>
<span id="418">418</span>
<span id="419">419</span>
<span id="420">420</span>
<span id="421">421</span>
<span id="422">422</span>
<span id="423">423</span>
<span id="424">424</span>
<span id="425">425</span>
<span id="426">426</span>
<span id="427">427</span>
<span id="428">428</span>
<span id="429">429</span>
<span id="430">430</span>
<span id="431">431</span>
</pre><pre class="rust">
<span class="doccomment">//! dropbox_backup_to_external_disk lib.rs</span>

<span class="comment">// region: auto_md_to_doc_comments include README.md A //!</span>
<span class="doccomment">//! # dropbox_backup_to_external_disk</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! **One way sync from dropbox to external disc**  </span>
<span class="doccomment">//! ***[repository](https://github.com/lucianobestia/dropbox_backup_to_external_disk/); version: 2021.818.2015  date: 2021-08-18 authors: Luciano Bestia***  </span>
<span class="doccomment">//!</span>
<span class="doccomment">//! [![Lines in Rust code](https://img.shields.io/badge/Lines_in_Rust-1790-green.svg)](https://github.com/LucianoBestia/dropbox_backup_to_external_disk/)</span>
<span class="doccomment">//! [![Lines in Doc comments](https://img.shields.io/badge/Lines_in_Doc_comments-249-blue.svg)](https://github.com/LucianoBestia/dropbox_backup_to_external_disk/)</span>
<span class="doccomment">//! [![Lines in Comments](https://img.shields.io/badge/Lines_in_comments-141-purple.svg)](https://github.com/LucianoBestia/dropbox_backup_to_external_disk/)</span>
<span class="doccomment">//! [![Lines in examples](https://img.shields.io/badge/Lines_in_examples-0-yellow.svg)](https://github.com/LucianoBestia/dropbox_backup_to_external_disk/)</span>
<span class="doccomment">//! [![Lines in tests](https://img.shields.io/badge/Lines_in_tests-0-orange.svg)](https://github.com/LucianoBestia/dropbox_backup_to_external_disk/)</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! [![Licence](https://img.shields.io/badge/license-MIT-blue.svg)](https://github.com/LucianoBestia/dropbox_backup_to_external_disk/blob/main/LICENSE) [![Rust](https://github.com/LucianoBestia/dropbox_backup_to_external_disk/workflows/RustAction/badge.svg)](https://github.com/LucianoBestia/dropbox_backup_to_external_disk/)</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ## Motivation</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! On my Dropbox &quot;remote drive&quot; I have more than 1 Terabyte of data in 200 000 files.  </span>
<span class="doccomment">//! I own now 4 notebooks and 2 android phones and 1 tablet and not a single one has an internal drive with more than 1 Terabyte. I use dropbox `Selective Sync` to sync only the bare minimum I temporarily need on the local device. But I want to have a backup of all of my data. I must have a backup. Better, I want to have 2 backups of all the data on 2 external hard disks in different locations. So if Dropbox go bankrupt, I still have all my data.  </span>
<span class="doccomment">//! The original Dropbox Sync app works great for the internal HD, but is &quot;not recommended&quot; for external drives. I also need only one way sync: from remote to local. There exist apps for that:</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! - rclone</span>
<span class="doccomment">//! - dropbox_uploader</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! But I wanted to write something mine for fun, learning Rust and using my own apps.</span>
<span class="doccomment">//! I have a lot of files, so I wanted to list them first - remote and local. Then compare the lists and finally download the files.  </span>
<span class="doccomment">//! Obsolete files will &quot;move to trash folder&quot;, so I can inspect what and how to delete manually.  </span>
<span class="doccomment">//! The dropbox remote storage will always be read_only, nothing will be modified there, never, no permission for that.  </span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ## Try it</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! There are a few manual steps for the security of you files on Dropbox. Authentication on internet is a complex topic.  </span>
<span class="doccomment">//! You should be logged in Linux terminal (also in WSL2) with your account. So things you do, are not visible to others. You will set some local environment variables that are private/secret to your linux Session.  After you logout from you Linux session these local environment variables will be deleted.  </span>
<span class="doccomment">//! The executable will create a sub-directory `temp_data` in the current directory. Maybe it is best if you create a dedicated directory `~/dropbox_backup_to_external_disk/` just for this executable.</span>
<span class="doccomment">//! Download the latest release from [Github](https://github.com/LucianoBestia/dropbox_backup_to_external_disk/releases) and make the file executable and enable auto-completion:</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ```bash</span>
<span class="doccomment">//! cd ~</span>
<span class="doccomment">//! mkdir dropbox_backup_to_external_disk</span>
<span class="doccomment">//! cd dropbox_backup_to_external_disk</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! curl -L https://github.com/LucianoBestia/dropbox_backup_to_external_disk/releases/latest/download/dropbox_backup_to_external_disk --output dropbox_backup_to_external_disk</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! chmod +x dropbox_backup_to_external_disk</span>
<span class="doccomment">//! alias dropbox_backup_to_external_disk=./dropbox_backup_to_external_disk</span>
<span class="doccomment">//! complete -C &quot;dropbox_backup_to_external_disk completion&quot; dropbox_backup_to_external_disk</span>
<span class="doccomment">//! dropbox_backup_to_external_disk --help</span>
<span class="doccomment">//! ```</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! Run the executable with --help and follow carefully the instructions 1. and 2.  </span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ![screenshot_1](https://github.com/LucianoBestia/dropbox_backup_to_external_disk/raw/main/images/screenshot_1.png &quot;screenshot_1&quot;) ![screenshot_2](https://github.com/LucianoBestia/dropbox_backup_to_external_disk/raw/main/images/screenshot_2.png &quot;screenshot_2&quot;) ![list_2](https://github.com/LucianoBestia/dropbox_backup_to_external_disk/raw/main/images/list_2.png &quot;list_2&quot;) ![list_3](https://github.com/LucianoBestia/dropbox_backup_to_external_disk/raw/main/images/list_3.png &quot;list_3&quot;) ![list_4](https://github.com/LucianoBestia/dropbox_backup_to_external_disk/raw/main/images/list_4.png &quot;list_4&quot;)</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ## Warning</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! I don&#39;t know why, but WSL2 sometimes does not see all the folders of the external disk.  </span>
<span class="doccomment">//! Instead of 12.000 folders it sees only 28 ???  </span>
<span class="doccomment">//! Be careful !  </span>
<span class="doccomment">//! I then restart my Win10 and the problem magically disappears.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ## Second backup</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! It is wise to have 2 backups on external disks and store them in separate locations. Just to be sure.  </span>
<span class="doccomment">//! If you have internet access on both places then you can sync backup_2 just the same way you sync backup_1.  </span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ![workflow_2](https://github.com/LucianoBestia/dropbox_backup_to_external_disk/raw/main/images/workflow_2.png &quot;workflow_2&quot;)</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! But sometimes your backup_1 is already in sync. And if both external disks are in the same place, it is faster to just one-way sync from backup_1 to backup_2 with `second_backup`.  </span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ![workflow_1](https://github.com/LucianoBestia/dropbox_backup_to_external_disk/raw/main/images/workflow_1.png &quot;workflow_1&quot;)</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ## Development</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! I use [cargo-auto](https://crates.io/crates/cargo-auto) for automation tasks in rust language. Install it:</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ```bash</span>
<span class="doccomment">//! cargo install cargo-auto</span>
<span class="doccomment">//! ```</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! List user-defined automation tasks in `automation_tasks_rs`:</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ```bash</span>
<span class="doccomment">//! cargo auto</span>
<span class="doccomment">//! ```</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! I use WSL2 on Win10 to develope and execute this CLI in Debian Linux.  </span>
<span class="doccomment">//! The external disk path from WSL2 looks like this: `/mnt/d/DropBoxBackup1`.  </span>
<span class="doccomment">//! CLI saves the list of the local files metadata in `temp_data/list_local_files.csv`.  </span>
<span class="doccomment">//! Save the list all the files metadata from the remote Dropbox to the file `temp_data/list_remote_files.csv`.</span>
<span class="doccomment">//! Tab delimited with metadata: path (with name), datetime modified, size.</span>
<span class="doccomment">//! The remote path is not really case-sensitive. They try to make it case-preserve, but this apply only to the last part of the path. Before that it is random-case.</span>
<span class="doccomment">//! For big dropbox remotes it can take a while to complete. After the first level folders are listed, I use 3 threads in a ThreadPool to get sub-folders recursively in parallel. It makes it much faster. Also the download of files is in parallel on multiple threads.  </span>
<span class="doccomment">//! The sorting of lists is also done in parallel with the crate Rayon.  </span>
<span class="doccomment">//! Once the lists are complete the CLI will compare them and create files:  </span>
<span class="doccomment">//! `list_for_correct_time.csv`  </span>
<span class="doccomment">//! `list_for_download.csv`  </span>
<span class="doccomment">//! `list_for_trash.csv`  </span>
<span class="doccomment">//! With this files the CLI will:  </span>
<span class="doccomment">//! `move_or_rename_local_files` if (name, size and file date) are equal, or (size, date and content_hash)</span>
<span class="doccomment">//! `trash_from_list` will move the obsolete files into a trash folder  </span>
<span class="doccomment">//! `correct_time_from_list` sometimes it is needed  </span>
<span class="doccomment">//! `download_from_list` - this can take a lot of time and it can be stopped with ctrl+c</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ## DropBox api2 - Stone sdk</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! Dropbox has made a `Stone` thingy that contains all the API definition. From there is possible to generate code boilerplate for different languages for the api-client.  </span>
<span class="doccomment">//! For Rust there is this quasi official project:  </span>
<span class="doccomment">//! &lt;https://crates.io/crates/dropbox-sdk&gt;  </span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ## Authorization OAuth2</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! Authorization on the internet is a mess. Dropbox api uses OAuth2.</span>
<span class="doccomment">//! Every app must be authorized on Dropbox and have its own `app key` and `app secret`.  </span>
<span class="doccomment">//! For commercial programs they probably embed them into the binary code somehow. But for OpenSource projects it is not possible to keep a secret. So the workaround is: every user must create a new `dropbox app` exclusive only to him. Creating a new app is simple. This app will stay forever in `development status` in dropbox, to be more private and secure. The  </span>
<span class="doccomment">//! `$ dropbox_backup_to_external_disk --help`  </span>
<span class="doccomment">//! has the detailed instructions.  </span>
<span class="doccomment">//! Then every time before use we need generate the &quot;short-lived access token&quot; for security reasons.  </span>
<span class="doccomment">//! ![dropbox_2](https://github.com/LucianoBestia/dropbox_backup_to_external_disk/raw/main/images/dropbox_2.png &quot;dropbox_2&quot;) ![dropbox_1](https://github.com/LucianoBestia/dropbox_backup_to_external_disk/raw/main/images/dropbox_1.png &quot;dropbox_1&quot;)</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ## rename or move</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! Often a file is renamed or moved to another folder.  </span>
<span class="doccomment">//! I can try to recognize if there is the same file in list_for_trash and list_for download.  </span>
<span class="doccomment">//! If the name, size and file date are equal then they are probably the same file.  </span>
<span class="doccomment">//! If the name is different, then try if content_hash is equal, but that is slow.  </span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ## bash auto-completion</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! This executable is prepared for auto-completion in bash.  </span>
<span class="doccomment">//! Run this command to define auto-completion in bash for the current session:  </span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ```bash</span>
<span class="doccomment">//! complete -C &quot;dropbox_backup_to_external_disk completion&quot; dropbox_backup_to_external_disk</span>
<span class="doccomment">//! ```</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! To make it permanent add this command to the file `~/.bashrc` or some other file that runs commands on bash initialization.  </span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ## Learn something new every day</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ### REGEX adventure with non-breaking space and CRLF</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! We all know space. But there are other non-visible characters that are very similar and sometimes impossible to distinguish. Tab is one of them, but it is not so difficult to spot with a quick try.  </span>
<span class="doccomment">//! But nbsp non-breaking space, often used in HTML is a catastrophe. There is no way to tell it apart from the normal space. I used a regex to find a match with some spaces. It worked right for a years. Yesterday it didn&#39;t work. If I changed space to `\s` in the regex expression, it worked, but not with space. I tried everything and didn&#39;t find the cause. Finally I deleted and inserted the space. It works. But how? After a detailed analysis I discovered it was a non-breakable space. This is unicode 160 or \xa0, instead of normal space unicode 32 \x20. Now I will try to find them all and replace with normal space. What a crazy world.  </span>
<span class="doccomment">//! And another REGEX surprise. I try to have all text files delimited with the unix standard LF. But somehow the windows standard got mixed and I didn&#39;t recognize it. The regex for `end of line` $ didn&#39;t work for CRLF. When I changed it to LF, the good life is back and all works.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ### Text files</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! Simple text files are a terrible way to store data that needs to be changed. It is ok for write once and then read. But there is not a good way to modify only one line inside a big text file. The recommended approach is read all, modify, save all. If the memory is not big enough then use a buffer to read a segment, modify, save a segment, repeat to end.  </span>
<span class="doccomment">//! There is another approach called memory map to file, but everybody is trying to avoid it because some other process could modify the file when in use and make it garbage.  </span>
<span class="doccomment">//! Sounds like a database is always a better choice for more agile development.  </span>
<span class="doccomment">//! In this project I will create additional files that only append lines. Some kind of journal. And later use this to modify the big text files in one go. For example: list_just_downloaded_or_moved.csv is added to list_local_files.csv.  </span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ### termion</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! After using some small crates to help me with Linux tty terminal ansi codes, I am happy to finally use only the `termion` crate.  </span>
<span class="doccomment">//! It has all I need.  </span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ## TODO</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! Can I recognize that a directory is moved or renamed? This is common and should be super fast.  </span>
<span class="doccomment">//! If most of the files in the directory are equal it means, that it is moved/renamed.  </span>
<span class="doccomment">//! Then a new `compare` will show if there are smaller differences.  </span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ## cargo crev reviews and advisory</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! We leave in times of danger with `supply chain attacks`.  </span>
<span class="doccomment">//! It is recommended to always use [cargo-crev](https://github.com/crev-dev/cargo-crev)  </span>
<span class="doccomment">//! to verify the trustworthiness of each of your dependencies.  </span>
<span class="doccomment">//! Please, spread this info.  </span>
<span class="doccomment">//! You can also read reviews quickly on the web. Example for the crate `num-traits`:  </span>
<span class="doccomment">//! &lt;https://web.crev.dev/rust-reviews/crate/num-traits/&gt;  </span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ## open-source free and free as a beer</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! My open-source projects are free and free as a beer (MIT license).  </span>
<span class="doccomment">//! I just love programming.  </span>
<span class="doccomment">//! But I need also to drink. If you find my projects and tutorials helpful, please buy me a beer or two donating on my [paypal](https://www.paypal.com/paypalme/LucianoBestia). You know the price of a beer in your local bar ;-)  </span>
<span class="doccomment">//! So I can drink a free beer for your health :-)  </span>
<span class="doccomment">//! [Na zdravje](https://translate.google.com/?hl=en&amp;sl=sl&amp;tl=en&amp;text=Na%20zdravje&amp;op=translate) !</span>
<span class="doccomment">//!</span>
<span class="comment">// endregion: auto_md_to_doc_comments include README.md A //!</span>

<span class="kw">mod</span> <span class="ident">local_mod</span>;
<span class="kw">mod</span> <span class="ident">remote_mod</span>;
<span class="kw">mod</span> <span class="ident">utils_mod</span>;

<span class="kw">use</span> <span class="ident">std::fs</span>;

<span class="kw">pub</span> <span class="kw">use</span> <span class="ident">local_mod</span>::<span class="kw-2">*</span>;
<span class="kw">pub</span> <span class="kw">use</span> <span class="ident">remote_mod</span>::<span class="kw-2">*</span>;
<span class="kw">pub</span> <span class="kw">use</span> <span class="ident">utils_mod</span>::<span class="kw-2">*</span>;

<span class="attribute">#[<span class="ident">allow</span>(<span class="ident">unused_imports</span>)]</span>
<span class="kw">use</span> <span class="ident">uncased::UncasedStr</span>;
<span class="kw">use</span> <span class="ident">unwrap::unwrap</span>;

<span class="doccomment">/// list and sync is the complete process for backup in one command</span>
<span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">list_and_sync</span>(<span class="ident">base_path</span>: <span class="kw-2">&amp;</span><span class="ident">str</span>) {
    <span class="kw">let</span> <span class="ident">_hide_cursor_terminal</span> <span class="op">=</span> <span class="kw">crate</span><span class="ident">::start_hide_cursor_terminal</span>();
    <span class="macro">print!</span>(<span class="string">&quot;{}&quot;</span>, <span class="kw-2">*</span><span class="ident">CLEAR_ALL</span>);
    <span class="macro">println!</span>(
        <span class="string">&quot;{}{}{}dropbox_backup_to_external_disk list_and_sync{}&quot;</span>,
        <span class="ident">at_line</span>(<span class="number">1</span>),
        <span class="kw-2">*</span><span class="ident">CLEAR_LINE</span>,
        <span class="kw-2">*</span><span class="ident">YELLOW</span>,
        <span class="kw-2">*</span><span class="ident">RESET</span>
    );
    <span class="ident">ns_start</span>(<span class="string">&quot;&quot;</span>);
    <span class="comment">// start 2 threads, first for remote list and second for local list</span>
    <span class="kw">use</span> <span class="ident">std::thread</span>;
    <span class="kw">let</span> <span class="ident">base_path</span> <span class="op">=</span> <span class="ident">base_path</span>.<span class="ident">to_string</span>();
    <span class="kw">let</span> <span class="ident">handle_2</span> <span class="op">=</span> <span class="ident">thread::spawn</span>(<span class="kw">move</span> <span class="op">|</span><span class="op">|</span> {
        <span class="macro">println!</span>(
            <span class="string">&quot;{}{}{}Threads for remote:{}&quot;</span>,
            <span class="ident">at_line</span>(<span class="number">3</span>),
            <span class="kw-2">*</span><span class="ident">CLEAR_LINE</span>,
            <span class="kw-2">*</span><span class="ident">GREEN</span>,
            <span class="kw-2">*</span><span class="ident">RESET</span>
        );
        <span class="comment">// prints at rows 4,5,6 and 7,8,9</span>
        <span class="ident">list_remote</span>();
    });
    <span class="kw">let</span> <span class="ident">handle_1</span> <span class="op">=</span> <span class="ident">thread::spawn</span>(<span class="kw">move</span> <span class="op">|</span><span class="op">|</span> {
        <span class="macro">println!</span>(
            <span class="string">&quot;{}{}{}Thread for local:{}&quot;</span>,
            <span class="ident">at_line</span>(<span class="number">12</span>),
            <span class="kw-2">*</span><span class="ident">CLEAR_LINE</span>,
            <span class="kw-2">*</span><span class="ident">GREEN</span>,
            <span class="kw-2">*</span><span class="ident">RESET</span>
        );
        <span class="comment">// prints at rows 13,14,15,16</span>
        <span class="ident">list_local</span>(<span class="kw-2">&amp;</span><span class="ident">base_path</span>);
    });
    <span class="comment">// wait for both threads to finish</span>
    <span class="ident">handle_1</span>.<span class="ident">join</span>().<span class="ident">unwrap</span>();
    <span class="ident">handle_2</span>.<span class="ident">join</span>().<span class="ident">unwrap</span>();
    <span class="macro">println!</span>(<span class="string">&quot;{}{}&quot;</span>, <span class="ident">at_line</span>(<span class="number">20</span>), <span class="kw-2">*</span><span class="ident">CLEAR_LINE</span>);
    <span class="ident">press_enter_to_continue_timeout_5_sec</span>();
    <span class="ident">sync_only</span>();
}

<span class="doccomment">/// sync_only can be stopped with ctrl+c and then restarted if downloading takes lots of time.  </span>
<span class="doccomment">/// No need to repeat the &quot;list&quot; that takes lots of times.  </span>
<span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">sync_only</span>() {
    <span class="macro">println!</span>(<span class="string">&quot;{}compare remote and local lists{}&quot;</span>, <span class="kw-2">*</span><span class="ident">YELLOW</span>, <span class="kw-2">*</span><span class="ident">RESET</span>);
    <span class="ident">compare_lists</span>();
    <span class="macro">println!</span>(<span class="string">&quot;{}rename or move equal files{}&quot;</span>, <span class="kw-2">*</span><span class="ident">YELLOW</span>, <span class="kw-2">*</span><span class="ident">RESET</span>);
    <span class="ident">move_or_rename_local_files</span>();
    <span class="macro">println!</span>(<span class="string">&quot;{}move to trash from list{}&quot;</span>, <span class="kw-2">*</span><span class="ident">YELLOW</span>, <span class="kw-2">*</span><span class="ident">RESET</span>);
    <span class="ident">trash_from_list</span>();
    <span class="macro">println!</span>(<span class="string">&quot;{}correct time from list{}&quot;</span>, <span class="kw-2">*</span><span class="ident">YELLOW</span>, <span class="kw-2">*</span><span class="ident">RESET</span>);
    <span class="ident">correct_time_from_list</span>();
    <span class="ident">press_enter_to_continue_timeout_5_sec</span>();
    <span class="ident">download_from_list</span>();
}

<span class="doccomment">/// compare list: the lists and produce list_for_download, list_for_trash, list_for_correct_time</span>
<span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">compare_lists</span>() {
    <span class="ident">add_just_downloaded_to_list_local</span>();
    <span class="kw">let</span> <span class="ident">path_list_source_files</span> <span class="op">=</span> <span class="string">&quot;temp_data/list_remote_files.csv&quot;</span>;
    <span class="kw">let</span> <span class="ident">path_list_destination_files</span> <span class="op">=</span> <span class="string">&quot;temp_data/list_local_files.csv&quot;</span>;
    <span class="kw">let</span> <span class="ident">path_list_for_download</span> <span class="op">=</span> <span class="string">&quot;temp_data/list_for_download.csv&quot;</span>;
    <span class="kw">let</span> <span class="ident">path_list_for_trash</span> <span class="op">=</span> <span class="string">&quot;temp_data/list_for_trash.csv&quot;</span>;
    <span class="kw">let</span> <span class="ident">path_list_for_correct_time</span> <span class="op">=</span> <span class="string">&quot;temp_data/list_for_correct_time.csv&quot;</span>;
    <span class="ident">compare_lists_internal</span>(
        <span class="ident">path_list_source_files</span>,
        <span class="ident">path_list_destination_files</span>,
        <span class="ident">path_list_for_download</span>,
        <span class="ident">path_list_for_trash</span>,
        <span class="ident">path_list_for_correct_time</span>,
    );
}

<span class="doccomment">/// compare list: the lists and produce list2_for_download, list2_for_trash, list2_for_correct_time</span>
<span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">compare2_lists</span>() {
    <span class="ident">add2_just_downloaded_to_list_local</span>();
    <span class="kw">let</span> <span class="ident">path_list_source_files</span> <span class="op">=</span> <span class="string">&quot;temp_data/list_local_files.csv&quot;</span>;
    <span class="kw">let</span> <span class="ident">path_list_destination_files</span> <span class="op">=</span> <span class="string">&quot;temp_data/list2_local_files.csv&quot;</span>;
    <span class="kw">let</span> <span class="ident">path_list_for_download</span> <span class="op">=</span> <span class="string">&quot;temp_data/list2_for_download.csv&quot;</span>;
    <span class="kw">let</span> <span class="ident">path_list_for_trash</span> <span class="op">=</span> <span class="string">&quot;temp_data/list2_for_trash.csv&quot;</span>;
    <span class="kw">let</span> <span class="ident">path_list_for_correct_time</span> <span class="op">=</span> <span class="string">&quot;temp_data/list2_for_correct_time.csv&quot;</span>;
    <span class="ident">compare_lists_internal</span>(
        <span class="ident">path_list_source_files</span>,
        <span class="ident">path_list_destination_files</span>,
        <span class="ident">path_list_for_download</span>,
        <span class="ident">path_list_for_trash</span>,
        <span class="ident">path_list_for_correct_time</span>,
    );
}

<span class="doccomment">/// compare list: the lists must be already sorted for this to work correctly</span>
<span class="kw">fn</span> <span class="ident">compare_lists_internal</span>(
    <span class="ident">path_list_source_files</span>: <span class="kw-2">&amp;</span><span class="ident">str</span>,
    <span class="ident">path_list_destination_files</span>: <span class="kw-2">&amp;</span><span class="ident">str</span>,
    <span class="ident">path_list_for_download</span>: <span class="kw-2">&amp;</span><span class="ident">str</span>,
    <span class="ident">path_list_for_trash</span>: <span class="kw-2">&amp;</span><span class="ident">str</span>,
    <span class="ident">path_list_for_correct_time</span>: <span class="kw-2">&amp;</span><span class="ident">str</span>,
) {
    <span class="kw">let</span> <span class="ident">string_remote</span> <span class="op">=</span> <span class="macro">unwrap!</span>(<span class="ident">fs::read_to_string</span>(<span class="ident">path_list_source_files</span>));
    <span class="kw">let</span> <span class="ident">vec_remote_lines</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="kw-2">&amp;</span><span class="ident">str</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">string_remote</span>.<span class="ident">lines</span>().<span class="ident">collect</span>();
    <span class="macro">println!</span>(
        <span class="string">&quot;{}: {}&quot;</span>,
        <span class="ident">path_list_source_files</span>.<span class="ident">split</span>(<span class="string">&quot;/&quot;</span>).<span class="ident">collect</span>::<span class="op">&lt;</span><span class="ident">Vec</span><span class="op">&lt;</span><span class="kw-2">&amp;</span><span class="ident">str</span><span class="op">&gt;</span><span class="op">&gt;</span>()[<span class="number">1</span>],
        <span class="ident">vec_remote_lines</span>.<span class="ident">len</span>()
    );
    <span class="kw">let</span> <span class="ident">string_destination</span> <span class="op">=</span> <span class="macro">unwrap!</span>(<span class="ident">fs::read_to_string</span>(<span class="ident">path_list_destination_files</span>));
    <span class="kw">let</span> <span class="ident">vec_destination_lines</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="kw-2">&amp;</span><span class="ident">str</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">string_destination</span>.<span class="ident">lines</span>().<span class="ident">collect</span>();
    <span class="macro">println!</span>(
        <span class="string">&quot;{}: {}&quot;</span>,
        <span class="ident">path_list_destination_files</span>
            .<span class="ident">split</span>(<span class="string">&quot;/&quot;</span>)
            .<span class="ident">collect</span>::<span class="op">&lt;</span><span class="ident">Vec</span><span class="op">&lt;</span><span class="kw-2">&amp;</span><span class="ident">str</span><span class="op">&gt;</span><span class="op">&gt;</span>()[<span class="number">1</span>],
        <span class="ident">vec_destination_lines</span>.<span class="ident">len</span>()
    );

    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">vec_for_download</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="ident">String</span><span class="op">&gt;</span> <span class="op">=</span> <span class="macro">vec!</span>[];
    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">vec_for_trash</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="ident">String</span><span class="op">&gt;</span> <span class="op">=</span> <span class="macro">vec!</span>[];
    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">vec_for_correct_time</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="ident">String</span><span class="op">&gt;</span> <span class="op">=</span> <span class="macro">vec!</span>[];
    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">cursor_source</span> <span class="op">=</span> <span class="number">0</span>;
    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">cursor_destination</span> <span class="op">=</span> <span class="number">0</span>;
    <span class="comment">//avoid making new allocations or shadowing inside a loop</span>
    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">vec_line_destination</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="kw-2">&amp;</span><span class="ident">str</span><span class="op">&gt;</span> <span class="op">=</span> <span class="macro">vec!</span>[];
    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">vec_line_source</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="kw-2">&amp;</span><span class="ident">str</span><span class="op">&gt;</span> <span class="op">=</span> <span class="macro">vec!</span>[];
    <span class="comment">//let mut i = 0;</span>
    <span class="kw">loop</span> {
        <span class="ident">vec_line_destination</span>.<span class="ident">truncate</span>(<span class="number">3</span>);
        <span class="ident">vec_line_source</span>.<span class="ident">truncate</span>(<span class="number">3</span>);

        <span class="kw">if</span> <span class="ident">cursor_source</span> <span class="op">&gt;</span><span class="op">=</span> <span class="ident">vec_remote_lines</span>.<span class="ident">len</span>()
            <span class="op">&amp;&amp;</span> <span class="ident">cursor_destination</span> <span class="op">&gt;</span><span class="op">=</span> <span class="ident">vec_destination_lines</span>.<span class="ident">len</span>()
        {
            <span class="kw">break</span>;
        } <span class="kw">else</span> <span class="kw">if</span> <span class="ident">cursor_source</span> <span class="op">&gt;</span><span class="op">=</span> <span class="ident">vec_remote_lines</span>.<span class="ident">len</span>() {
            <span class="comment">// final lines</span>
            <span class="ident">vec_for_trash</span>.<span class="ident">push</span>(<span class="ident">vec_destination_lines</span>[<span class="ident">cursor_destination</span>].<span class="ident">to_string</span>());
            <span class="ident">cursor_destination</span> <span class="op">+</span><span class="op">=</span> <span class="number">1</span>;
        } <span class="kw">else</span> <span class="kw">if</span> <span class="ident">cursor_destination</span> <span class="op">&gt;</span><span class="op">=</span> <span class="ident">vec_destination_lines</span>.<span class="ident">len</span>() {
            <span class="comment">// final lines</span>
            <span class="ident">vec_for_download</span>.<span class="ident">push</span>(<span class="ident">vec_remote_lines</span>[<span class="ident">cursor_source</span>].<span class="ident">to_string</span>());
            <span class="ident">cursor_source</span> <span class="op">+</span><span class="op">=</span> <span class="number">1</span>;
        } <span class="kw">else</span> {
            <span class="ident">vec_line_source</span> <span class="op">=</span> <span class="ident">vec_remote_lines</span>[<span class="ident">cursor_source</span>].<span class="ident">split</span>(<span class="string">&quot;\t&quot;</span>).<span class="ident">collect</span>();
            <span class="ident">vec_line_destination</span> <span class="op">=</span> <span class="ident">vec_destination_lines</span>[<span class="ident">cursor_destination</span>]
                .<span class="ident">split</span>(<span class="string">&quot;\t&quot;</span>)
                .<span class="ident">collect</span>();
            <span class="comment">// UncasedStr preserves the case in the string, but comparison is done case insensitive</span>
            <span class="kw">let</span> <span class="ident">path_source</span>: <span class="kw-2">&amp;</span><span class="ident">UncasedStr</span> <span class="op">=</span> <span class="ident">vec_line_source</span>[<span class="number">0</span>].<span class="ident">into</span>();
            <span class="kw">let</span> <span class="ident">path_destination</span>: <span class="kw-2">&amp;</span><span class="ident">UncasedStr</span> <span class="op">=</span> <span class="ident">vec_line_destination</span>[<span class="number">0</span>].<span class="ident">into</span>();

            <span class="comment">//println!(&quot;{}&quot;,path_source);</span>
            <span class="comment">//println!(&quot;{}&quot;,path_destination);</span>
            <span class="kw">if</span> <span class="ident">path_source</span>.<span class="ident">lt</span>(<span class="ident">path_destination</span>) {
                <span class="comment">//println!(&quot;lt&quot;);</span>
                <span class="ident">vec_for_download</span>.<span class="ident">push</span>(<span class="ident">vec_remote_lines</span>[<span class="ident">cursor_source</span>].<span class="ident">to_string</span>());
                <span class="ident">cursor_source</span> <span class="op">+</span><span class="op">=</span> <span class="number">1</span>;
            } <span class="kw">else</span> <span class="kw">if</span> <span class="ident">path_source</span>.<span class="ident">gt</span>(<span class="ident">path_destination</span>) {
                <span class="comment">//println!(&quot;gt&quot; );</span>
                <span class="ident">vec_for_trash</span>.<span class="ident">push</span>(<span class="ident">vec_destination_lines</span>[<span class="ident">cursor_destination</span>].<span class="ident">to_string</span>());
                <span class="ident">cursor_destination</span> <span class="op">+</span><span class="op">=</span> <span class="number">1</span>;
            } <span class="kw">else</span> {
                <span class="comment">//println!(&quot;eq&quot;);</span>
                <span class="comment">// equal names. check date and size</span>
                <span class="comment">// println!(&quot;Equal names: {}   {}&quot;,path_remote,path_destination);</span>
                <span class="comment">// if equal size and time difference only in seconds, then correct destination time</span>
                <span class="kw">if</span> <span class="ident">vec_line_source</span>[<span class="number">2</span>] <span class="op">=</span><span class="op">=</span> <span class="ident">vec_line_destination</span>[<span class="number">2</span>]
                    <span class="op">&amp;&amp;</span> <span class="ident">vec_line_source</span>[<span class="number">1</span>] <span class="op">!</span><span class="op">=</span> <span class="ident">vec_line_destination</span>[<span class="number">1</span>]
                    <span class="op">&amp;&amp;</span> <span class="ident">vec_line_source</span>[<span class="number">1</span>][<span class="number">0</span>..<span class="number">17</span>] <span class="op">=</span><span class="op">=</span> <span class="ident">vec_line_destination</span>[<span class="number">1</span>][<span class="number">0</span>..<span class="number">17</span>]
                {
                    <span class="ident">vec_for_correct_time</span>
                        .<span class="ident">push</span>(<span class="macro">format!</span>(<span class="string">&quot;{}\t{}&quot;</span>, <span class="ident">path_destination</span>, <span class="ident">vec_line_source</span>[<span class="number">1</span>]));
                } <span class="kw">else</span> <span class="kw">if</span> <span class="ident">vec_line_source</span>[<span class="number">1</span>] <span class="op">!</span><span class="op">=</span> <span class="ident">vec_line_destination</span>[<span class="number">1</span>]
                    <span class="op">|</span><span class="op">|</span> <span class="ident">vec_line_source</span>[<span class="number">2</span>] <span class="op">!</span><span class="op">=</span> <span class="ident">vec_line_destination</span>[<span class="number">2</span>]
                {
                    <span class="comment">//println!(&quot;Equal names: {}   {}&quot;, path_remote, path_destination);</span>
                    <span class="comment">//println!(</span>
                    <span class="comment">//&quot;Different date or size {} {} {} {}&quot;,</span>
                    <span class="comment">//line_remote[1], line_destination[1], line_remote[2], line_local[2]</span>
                    <span class="comment">//);</span>
                    <span class="ident">vec_for_download</span>.<span class="ident">push</span>(<span class="ident">vec_remote_lines</span>[<span class="ident">cursor_source</span>].<span class="ident">to_string</span>());
                }
                <span class="comment">// else the metadata is the same, no action</span>
                <span class="ident">cursor_destination</span> <span class="op">+</span><span class="op">=</span> <span class="number">1</span>;
                <span class="ident">cursor_source</span> <span class="op">+</span><span class="op">=</span> <span class="number">1</span>;
            }
        }
    }
    <span class="macro">println!</span>(
        <span class="string">&quot;{}: {}&quot;</span>,
        <span class="ident">path_list_for_download</span>.<span class="ident">split</span>(<span class="string">&quot;/&quot;</span>).<span class="ident">collect</span>::<span class="op">&lt;</span><span class="ident">Vec</span><span class="op">&lt;</span><span class="kw-2">&amp;</span><span class="ident">str</span><span class="op">&gt;</span><span class="op">&gt;</span>()[<span class="number">1</span>],
        <span class="ident">vec_for_download</span>.<span class="ident">len</span>()
    );
    <span class="kw">let</span> <span class="ident">string_for_download</span> <span class="op">=</span> <span class="ident">vec_for_download</span>.<span class="ident">join</span>(<span class="string">&quot;\n&quot;</span>);
    <span class="macro">unwrap!</span>(<span class="ident">fs::write</span>(<span class="ident">path_list_for_download</span>, <span class="ident">string_for_download</span>));

    <span class="macro">println!</span>(
        <span class="string">&quot;{}: {}&quot;</span>,
        <span class="ident">path_list_for_trash</span>.<span class="ident">split</span>(<span class="string">&quot;/&quot;</span>).<span class="ident">collect</span>::<span class="op">&lt;</span><span class="ident">Vec</span><span class="op">&lt;</span><span class="kw-2">&amp;</span><span class="ident">str</span><span class="op">&gt;</span><span class="op">&gt;</span>()[<span class="number">1</span>],
        <span class="ident">vec_for_trash</span>.<span class="ident">len</span>()
    );
    <span class="kw">let</span> <span class="ident">string_for_trash</span> <span class="op">=</span> <span class="ident">vec_for_trash</span>.<span class="ident">join</span>(<span class="string">&quot;\n&quot;</span>);
    <span class="macro">unwrap!</span>(<span class="ident">fs::write</span>(<span class="ident">path_list_for_trash</span>, <span class="ident">string_for_trash</span>));

    <span class="macro">println!</span>(
        <span class="string">&quot;{}: {}&quot;</span>,
        <span class="ident">path_list_for_correct_time</span>.<span class="ident">split</span>(<span class="string">&quot;/&quot;</span>).<span class="ident">collect</span>::<span class="op">&lt;</span><span class="ident">Vec</span><span class="op">&lt;</span><span class="kw-2">&amp;</span><span class="ident">str</span><span class="op">&gt;</span><span class="op">&gt;</span>()[<span class="number">1</span>],
        <span class="ident">vec_for_correct_time</span>.<span class="ident">len</span>()
    );
    <span class="kw">let</span> <span class="ident">string_for_correct_time</span> <span class="op">=</span> <span class="ident">vec_for_correct_time</span>.<span class="ident">join</span>(<span class="string">&quot;\n&quot;</span>);
    <span class="macro">unwrap!</span>(<span class="ident">fs::write</span>(
        <span class="ident">path_list_for_correct_time</span>,
        <span class="ident">string_for_correct_time</span>
    ));
}

<span class="doccomment">/// After the first backup from dropbox, we want to make a second backup from the first backup.  </span>
<span class="doccomment">/// Ideally, we put it somewhere safe in a distant location.  </span>
<span class="doccomment">/// Having 2 external disks on the same computer, it is faster to just copy files then to question for calculating hash.  </span>
<span class="doccomment">/// No need to move files or correct time. Just copy it. It is faster.  </span>
<span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">second_backup</span>(<span class="ident">base_path</span>: <span class="kw-2">&amp;</span><span class="ident">str</span>) {
    <span class="ident">list2_local</span>(<span class="ident">base_path</span>);
    <span class="comment">// compare list_local_files and list2_local_files</span>
    <span class="ident">compare2_lists</span>();
    <span class="ident">trash2_from_list</span>();
    <span class="comment">// copy instead of download, no multi-thread</span>
    <span class="ident">copy_from_list2_for_download</span>(<span class="string">&quot;temp_data/list2_for_download.csv&quot;</span>);
    <span class="comment">// just copy also the files for correct time. It is faster then hash.</span>
    <span class="ident">copy_from_list2_for_download</span>(<span class="string">&quot;temp_data/list2_for_correct_time.csv&quot;</span>);
    <span class="macro">println!</span>(<span class="string">&quot;{}compare local and local2 lists{}&quot;</span>, <span class="kw-2">*</span><span class="ident">YELLOW</span>, <span class="kw-2">*</span><span class="ident">RESET</span>);
    <span class="ident">compare2_lists</span>();
}
</pre></div>
</section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../../" data-current-crate="dropbox_backup_to_external_disk" data-search-index-js="../../search-index.js" data-search-js="../../search.js"></div><script src="../../main.js"></script><script src="../../source-script.js"></script><script src="../../source-files.js"></script></body></html>